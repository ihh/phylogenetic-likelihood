// Le & Gascuel, 2008
const LeGascuel = {
  alphabet: "ARNDCQEGHILKMFPSTWYV",
  rootprob: {
    A: 0.079066,
    R: 0.055941,
    N: 0.041977,
    D: 0.053052,
    C: 0.012937,
    Q: 0.040767,
    E: 0.071586,
    G: 0.057337,
    H: 0.022355,
    I: 0.062157,
    L: 0.099081,
    K: 0.0646,
    M: 0.022951,
    F: 0.042302,
    P: 0.04404,
    S: 0.061197,
    T: 0.053287,
    W: 0.012066,
    Y: 0.034155,
    V: 0.069147
  },
  subrate: {
    A: {
      R: 0.023780059838785415,
      N: 0.011619956117479187,
      D: 0.020963119830342308,
      C: 0.03220118806861281,
      Q: 0.039539556174800844,
      E: 0.07434507079592036,
      G: 0.11846019836138307,
      H: 0.008022247759976862,
      I: 0.009312956806827104,
      L: 0.039170273824718854,
      K: 0.034658964166178474,
      M: 0.025797653869038237,
      F: 0.010732029160376083,
      P: 0.051863602444553035,
      S: 0.28928853358549556,
      T: 0.11400726534071219,
      W: 0.002180525116577236,
      Y: 0.007478523362328794,
      V: 0.17617706551848886
    },
    R: {
      A: 0.03361030748848622,
      N: 0.03156149298708182,
      D: 0.0065759888937963135,
      C: 0.006915466606697501,
      Q: 0.11446965967381248,
      E: 0.02605508227143853,
      G: 0.022372375035829305,
      H: 0.0542465109781797,
      I: 0.007893357123778822,
      L: 0.029907316576601065,
      K: 0.40866276521168743,
      M: 0.011111304862018612,
      F: 0.002230239697097559,
      P: 0.014644711643512854,
      S: 0.05251611729460102,
      T: 0.03085239246806752,
      W: 0.007162441678846282,
      Y: 0.010739667636638212,
      V: 0.011816289761745303
    },
    N: {
      A: 0.02188682970161301,
      R: 0.04206068750006776,
      D: 0.2692990903662267,
      C: 0.006840652148607381,
      Q: 0.06913052504967644,
      E: 0.03877888487354867,
      G: 0.08243001678246818,
      H: 0.10080372861884797,
      I: 0.011903218096361284,
      L: 0.006779796292793331,
      K: 0.13857164444745146,
      M: 0.008514888572000574,
      F: 0.0037870757725932055,
      P: 0.007125079203173861,
      S: 0.24529878644522043,
      T: 0.10660987847848198,
      W: 0.0005475052578883485,
      Y: 0.02090365438657137,
      V: 0.00578675766782108
    },
    D: {
      A: 0.031242366593264063,
      R: 0.006934090980695536,
      N: 0.213080900179128,
      C: 0.0008092846689063697,
      Q: 0.021336816340862316,
      E: 0.37538660953025904,
      G: 0.048445384194250804,
      H: 0.020725574488358038,
      I: 0.000664456439064151,
      L: 0.0014937409050543244,
      K: 0.01827909938063158,
      M: 0.000586350479341114,
      F: 0.0007367295353865765,
      P: 0.01737179280267975,
      S: 0.07590089317330083,
      T: 0.02269273724013015,
      W: 0.00036065171364339603,
      Y: 0.004614566452688203,
      V: 0.0026252966778291145
    },
    C: {
      A: 0.1968013554790863,
      R: 0.029903232391224,
      N: 0.022196031169675508,
      D: 0.003318711467482471,
      Q: 0.003457357896917096,
      E: 0.0002504787011780186,
      G: 0.03263985441723913,
      H: 0.01431929801458755,
      I: 0.019929155723837376,
      L: 0.05885464007618758,
      K: 0.0008569811611698462,
      M: 0.020510791309596318,
      F: 0.04675419474710319,
      P: 0.003319813832345319,
      S: 0.17040121523162713,
      T: 0.0609324453560889,
      W: 0.008085741437284098,
      Y: 0.03980863217105396,
      V: 0.1354787092264462
    },
    Q: {
      A: 0.07668542076966182,
      R: 0.15707673441295028,
      N: 0.07118237913043068,
      D: 0.027766595052749227,
      C: 0.0010971579736653782,
      E: 0.2955484742427142,
      G: 0.01536392145975772,
      H: 0.10760559804682471,
      I: 0.004528373190980324,
      L: 0.057710257782915005,
      K: 0.20893479780526658,
      M: 0.03838702187572755,
      F: 0.0015167338936199874,
      P: 0.027493829516995943,
      S: 0.0748943889786494,
      T: 0.05755704323393889,
      W: 0.0028499690234478586,
      Y: 0.008789286067109561,
      V: 0.014543785414732618
    },
    E: {
      A: 0.08211336528860726,
      R: 0.020360787826482037,
      N: 0.02273937991139263,
      D: 0.27819699953621246,
      C: 0.000045266434179029796,
      Q: 0.1683097903144851,
      G: 0.02000178351715039,
      H: 0.009475832788308334,
      I: 0.0027513717750397237,
      L: 0.006903250867461523,
      K: 0.11674330196739328,
      M: 0.003987380637557869,
      F: 0.0007957406574504417,
      P: 0.018470719795310783,
      S: 0.03745080510204949,
      T: 0.032214297738304795,
      W: 0.0009393595587342143,
      Y: 0.004099852067482321,
      V: 0.01694331778005055
    },
    G: {
      A: 0.1633530537635578,
      R: 0.02182766855397609,
      N: 0.06034785242474609,
      D: 0.044824886587603016,
      C: 0.007364560346649156,
      Q: 0.010923853465475052,
      E: 0.024972490274320733,
      H: 0.006963205003841722,
      I: 0.000541075145187412,
      L: 0.004385411660825779,
      K: 0.019162631066242917,
      M: 0.0032025275241232332,
      F: 0.0037896561872497615,
      P: 0.008674137754803087,
      S: 0.1064818649997877,
      T: 0.006918551242919123,
      W: 0.003239603186611878,
      Y: 0.0018675559302370587,
      V: 0.0053036289537274715
    },
    H: {
      A: 0.0283733858819204,
      R: 0.13574610022949454,
      N: 0.18928374485499355,
      D: 0.04918511195510492,
      C: 0.00828668120844192,
      Q: 0.1962315998915188,
      E: 0.030343858912271992,
      G: 0.017859507282723005,
      I: 0.006767759214048915,
      L: 0.03629495138742272,
      K: 0.04504312621452824,
      M: 0.010155145972092586,
      F: 0.028855761859156177,
      P: 0.02240973426551097,
      S: 0.06058559194717776,
      T: 0.031133480593136052,
      W: 0.0072040330624839125,
      Y: 0.18125439944921548,
      V: 0.008229368491544669
    },
    I: {
      A: 0.011846425066985085,
      R: 0.007103983314209358,
      N: 0.008038698554160555,
      D: 0.0005671242660558157,
      C: 0.004147939694632691,
      Q: 0.002970030565772075,
      E: 0.003168745272262073,
      G: 0.0004991171645930569,
      H: 0.002434050183085791,
      L: 0.4106962146518183,
      K: 0.010275828156650554,
      M: 0.0980832751278198,
      F: 0.047070443599109967,
      P: 0.003447485429012548,
      S: 0.003923022520710688,
      T: 0.05508469333084793,
      W: 0.001347285725842141,
      Y: 0.00794180046391689,
      V: 0.7363517061908176
    },
    L: {
      A: 0.03125762628783743,
      R: 0.016885630914218068,
      N: 0.0028723520047495045,
      D: 0.0007998096758706717,
      C: 0.007684646689735052,
      Q: 0.02374495694468259,
      E: 0.004987597184102912,
      G: 0.002537785734871143,
      H: 0.008188993230446149,
      I: 0.2576441963051752,
      K: 0.008882474721909684,
      M: 0.1448745161684952,
      F: 0.10967574486452078,
      P: 0.010968571185215636,
      S: 0.011155385792571396,
      T: 0.016142504693035426,
      W: 0.007476458435205244,
      Y: 0.010234448314410912,
      V: 0.1177393734477345
    },
    K: {
      A: 0.042420211466920536,
      R: 0.35388550694592885,
      N: 0.09004368295620233,
      D: 0.015011498147697625,
      C: 0.00017162175359217182,
      Q: 0.13185208826822448,
      E: 0.12936820456095688,
      G: 0.017008169929491793,
      H: 0.015587292361080167,
      I: 0.009887223695556167,
      L: 0.0136235987294355,
      M: 0.01506967551813421,
      F: 0.0010117763566476882,
      P: 0.01718973196079554,
      S: 0.04581702316314235,
      T: 0.060579846280528996,
      W: 0.0006021640823381505,
      Y: 0.004506124636296121,
      V: 0.012806126249830319
    },
    M: {
      A: 0.08887269839263551,
      R: 0.027082807079699497,
      N: 0.015573590588073203,
      D: 0.0013553686388394746,
      C: 0.011561505257820905,
      Q: 0.06818542637827482,
      E: 0.01243695831642271,
      G: 0.008000667537390694,
      H: 0.009891433410576,
      I: 0.2656338343479541,
      L: 0.6254329631166691,
      K: 0.042416497689489345,
      F: 0.07609486305229383,
      P: 0.004397337445886918,
      S: 0.021232850694731777,
      T: 0.10765893666203162,
      W: 0.008400023644887627,
      Y: 0.016438959647372443,
      V: 0.13129027991504044
    },
    F: {
      A: 0.02005906618113317,
      R: 0.0029493130087309004,
      N: 0.0037579802303944255,
      D: 0.0009239510025844798,
      C: 0.014298591495514964,
      Q: 0.0014616966252471758,
      E: 0.0013466004137924288,
      G: 0.005136577864127927,
      H: 0.015249173948310633,
      I: 0.06916357531062074,
      L: 0.25688578499649156,
      K: 0.0015450984028991695,
      M: 0.04128535771153127,
      P: 0.004160182720791013,
      S: 0.022142174329943386,
      T: 0.008792383265295436,
      W: 0.02964753761389009,
      Y: 0.26654151427584344,
      V: 0.04526923657205464
    },
    P: {
      A: 0.09311188898458286,
      R: 0.01860217561420873,
      N: 0.00679131357201701,
      D: 0.02092662015821449,
      C: 0.0009752141586978062,
      Q: 0.025450521069922197,
      E: 0.030023727231315116,
      G: 0.011293120718600011,
      H: 0.011375331732640728,
      I: 0.00486569827000756,
      L: 0.024677043633114223,
      K: 0.025214729442947136,
      M: 0.0022916278773966996,
      F: 0.003996004756015019,
      S: 0.08188943095988824,
      T: 0.030451728655292103,
      W: 0.0011478473794115057,
      Y: 0.0030607233046751683,
      V: 0.020502096301340908
    },
    S: {
      A: 0.37375830835614154,
      R: 0.04800568847455391,
      N: 0.16825836492983345,
      D: 0.06579888204699504,
      C: 0.0360226893712365,
      Q: 0.049891654092399956,
      E: 0.043808574505863264,
      G: 0.0997655227134145,
      H: 0.022131655276878912,
      I: 0.0039845631455759966,
      L: 0.018061126847946248,
      K: 0.048364784161625506,
      M: 0.007963056298426214,
      F: 0.015305623780663514,
      P: 0.05893116557140837,
      T: 0.3448873495792334,
      W: 0.003002760346628398,
      Y: 0.01368064385209428,
      V: 0.006801901885884378
    },
    T: {
      A: 0.1691613046602126,
      R: 0.03238901959307458,
      N: 0.08398226338302472,
      D: 0.022592660424932624,
      C: 0.014793158661056585,
      Q: 0.0440337789989676,
      E: 0.043276835211107534,
      G: 0.007444385546479512,
      H: 0.013061139840102773,
      I: 0.06425393216667319,
      L: 0.03001511639782016,
      K: 0.07344114079835933,
      M: 0.046369288106485405,
      F: 0.006979852438465809,
      P: 0.025167379097698582,
      S: 0.3960829307748671,
      W: 0.0016991896143804365,
      Y: 0.008396675459416025,
      V: 0.1513041306388495
    },
    W: {
      A: 0.014288529659149325,
      R: 0.03320687468559091,
      N: 0.0019047429314088518,
      D: 0.0015857197672973185,
      C: 0.008669421264225458,
      Q: 0.009629097230142453,
      E: 0.005573097411863705,
      G: 0.015394424656950543,
      H: 0.013347104186294369,
      I: 0.006940430868653237,
      L: 0.061393583475764194,
      K: 0.003223918425248179,
      M: 0.015977866954567873,
      F: 0.10394083674314425,
      P: 0.004189557317195649,
      S: 0.015229564473116035,
      T: 0.007504120419483699,
      Y: 0.10764993497064898,
      V: 0.013104010678099284
    },
    Y: {
      A: 0.017312163026376472,
      R: 0.017590037981589174,
      N: 0.025690900312841648,
      D: 0.007167676165949777,
      C: 0.015078444573178895,
      Q: 0.010490786856912765,
      E: 0.008592944227866767,
      G: 0.0031351209009516097,
      H: 0.11863393645695247,
      I: 0.014452890980403517,
      L: 0.029689338996930104,
      K: 0.00852278294553446,
      M: 0.011046422569663152,
      F: 0.33011972293651676,
      P: 0.003946545288768685,
      S: 0.02451220500121838,
      T: 0.013100092086250964,
      W: 0.038029691563631986,
      V: 0.017239196951026155
    },
    V: {
      A: 0.20144931612774003,
      R: 0.009559562462027188,
      N: 0.003512961178679125,
      D: 0.002014219551856049,
      C: 0.025347275532742342,
      Q: 0.008574580242127707,
      E: 0.017540954005274254,
      G: 0.004397792721591278,
      H: 0.0026605280435663308,
      I: 0.661914660096644,
      L: 0.16870919722583744,
      K: 0.011964015152342671,
      M: 0.04357735280388293,
      F: 0.027694321452428235,
      P: 0.013057866879417094,
      S: 0.006019870561419386,
      T: 0.11660004352108369,
      W: 0.002286621152645031,
      Y: 0.008515261281939902
    }
  }
};

const makeGappedModel = (opts) => {
  let { model, deletionRate, gapChar, gapFreq } = opts;
  deletionRate = deletionRate || 0.05;  // Miklos, Lunter & Holmes, 2004
  gapChar = gapChar || '-';
  gapFreq = gapFreq || 0.5;
  const insertionRate = deletionRate * gapFreq / (1 - gapFreq);
  const alphabet = model.alphabet.split('');
  const gappedModel = { alphabet: model.alphabet + gapChar,
                        rootprob: {},
                        subrate: {} };
  gappedModel.rootprob[gapChar] = gapFreq;
  gappedModel.subrate[gapChar] = {};
  alphabet.forEach ((c) => {
    gappedModel.rootprob[c] = (1 - gapFreq) * model.rootprob[c];
    gappedModel.subrate[c] = {};
    Object.keys(model.subrate[c]).forEach ((d) => {
      gappedModel.subrate[c][d] = model.subrate[c][d];
    });
    gappedModel.subrate[gapChar][c] = model.rootprob[c] * insertionRate;
    gappedModel.subrate[c][gapChar] = deletionRate;
  })
  return gappedModel;
}

module.exports = { LeGascuel,
                   makeGappedModel };
